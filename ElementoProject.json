{
  "id": "project_1",
  "name": "Elemento Games Site",
  "properties": {},
  "elements": [
    {
      "id": "app_1",
      "name": "Puzzles",
      "properties": {
        "fonts": "Road Rage\nGrape Nuts",
        "maxWidth": "600px",
        "cookieMessage": "We use cookies for the usual things - to make the site work properly and learn how people use it.",
        "faviconUrl": "puzzleteams_icon_plain.svg",
        "messageAction": {
          "expr": "If(And($message.score, CurrentUser()), StoreGamePlay($message))\n"
        }
      },
      "elements": [
        {
          "id": "webfiledatastore_1",
          "name": "Site Data Store",
          "properties": {
            "url": "https://firebasestorage.googleapis.com/v0/b/elemento-games-site.appspot.com/o/public%2FsiteData.json?alt=media"
          },
          "kind": "WebFileDataStore"
        },
        {
          "id": "firestoredatastore_1",
          "name": "Player Data Store",
          "properties": {
            "collections": "GamePlays\nUsers\nTeams\nInvites\nPuzzles\nDayPuzzles"
          },
          "kind": "FirestoreDataStore"
        },
        {
          "id": "serverappconnector_1",
          "name": "Puzzles Server App",
          "properties": {
            "serverApp": {
              "expr": "PuzzlesServer"
            }
          },
          "kind": "ServerAppConnector"
        },
        {
          "id": "collection_1",
          "name": "Puzzles",
          "properties": {
            "dataStore": {
              "expr": "PlayerDataStore"
            },
            "collectionName": "Puzzles"
          },
          "kind": "Collection"
        },
        {
          "id": "collection_2",
          "name": "Game Plays",
          "properties": {
            "dataStore": {
              "expr": "PlayerDataStore"
            },
            "collectionName": "GamePlays"
          },
          "kind": "Collection"
        },
        {
          "id": "collection_5",
          "name": "Users",
          "properties": {
            "dataStore": {
              "expr": "PlayerDataStore"
            },
            "collectionName": "Users"
          },
          "kind": "Collection"
        },
        {
          "id": "collection_6",
          "name": "Teams",
          "properties": {
            "dataStore": {
              "expr": "PlayerDataStore"
            },
            "collectionName": "Teams"
          },
          "kind": "Collection"
        },
        {
          "id": "collection_8",
          "name": "Invites",
          "properties": {
            "dataStore": {
              "expr": "PlayerDataStore"
            },
            "collectionName": "Invites"
          },
          "kind": "Collection"
        },
        {
          "id": "function_3",
          "name": "Store Game Play",
          "properties": {
            "input1": "data",
            "action": true,
            "calculation": {
              "expr": "Log('StoreGamePlay', data)\nlet puzzleUrl = data.url.replace(/\\/$/, '')\nlet puzzleResult = Query(Puzzles, {url: puzzleUrl})\nlet puzzle = puzzleResult[0]\nlet score = data.score\nlet teamId = UserData().TeamId\nLog(CurrentUser().uid, teamId, puzzle.id, score)\nAdd(GamePlays, Record('DateTime', Now(), 'UserId', CurrentUser().uid, 'TeamId', teamId, 'PuzzleId', puzzle.id, 'Score', score))"
            }
          },
          "kind": "Function"
        },
        {
          "id": "function_16",
          "name": "Puzzle Of The Day",
          "properties": {
            "calculation": {
              "expr": "PuzzlesServerApp.PuzzleOfTheDay()"
            }
          },
          "kind": "Function"
        },
        {
          "id": "function_7",
          "name": "User Data",
          "properties": {
            "calculation": {
              "expr": "If(CurrentUser(), GetIfExists(Users, CurrentUser().uid))"
            }
          },
          "kind": "Function"
        },
        {
          "id": "function_9",
          "name": "Users Team",
          "properties": {
            "action": false,
            "calculation": {
              "expr": "let teamId = UserData()?.TeamId\nIf(teamId, Get(Teams, teamId))"
            }
          },
          "kind": "Function"
        },
        {
          "id": "function_8",
          "name": "Is Team Owner",
          "properties": {
            "action": false,
            "calculation": {
              "expr": "And(CurrentUser(), UsersTeam()?.OwnerId == CurrentUser()?.uid)"
            }
          },
          "kind": "Function"
        },
        {
          "id": "appbar_1",
          "name": "Main App Bar",
          "properties": {
            "styles": {
              "backgroundColor": "orange",
              "color": "green",
              "fontSize": "32",
              "fontFamily": "Road Rage"
            }
          },
          "elements": [
            {
              "id": "calculation_3",
              "name": "Narrow Screen",
              "properties": {
                "calculation": {
                  "expr": "AppWidth() < 630"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "image_1",
              "name": "Logo",
              "properties": {
                "source": "puzzleteams_icon_plain.svg",
                "styles": {
                  "width": "40",
                  "borderRadius": "5",
                  "border": "2px solid #888"
                }
              },
              "kind": "Image"
            },
            {
              "id": "text_24",
              "name": "App Title",
              "properties": {
                "content": "Puzzle Teams",
                "styles": {
                  "fontFamily": "Road Rage",
                  "fontSize": "32"
                },
                "show": {
                  "expr": "Not(NarrowScreen)"
                }
              },
              "kind": "Text"
            },
            {
              "id": "block_2",
              "name": "Nav Items",
              "properties": {
                "layout": "horizontal"
              },
              "elements": [
                {
                  "id": "menu_3",
                  "name": "Puzzles Menu",
                  "properties": {
                    "label": "Puzzles",
                    "buttonStyles": {
                      "color": "white"
                    },
                    "iconName": {
                      "expr": "If(NarrowScreen, 'extension')"
                    }
                  },
                  "elements": [
                    {
                      "id": "menuitem_21",
                      "name": "Todays Puzzle",
                      "properties": {
                        "label": "Puzzle of the Day",
                        "action": {
                          "expr": "ShowPage(TodaysPuzzle)"
                        }
                      },
                      "kind": "MenuItem"
                    },
                    {
                      "id": "menuitem_20",
                      "name": "Puzzle List",
                      "properties": {
                        "label": "All the Puzzles",
                        "action": {
                          "expr": "ShowPage(PuzzleArchive)"
                        }
                      },
                      "kind": "MenuItem"
                    }
                  ],
                  "kind": "Menu"
                },
                {
                  "id": "menu_1",
                  "name": "Leagues Menu",
                  "properties": {
                    "label": "Leagues",
                    "buttonStyles": {
                      "color": "white"
                    },
                    "iconName": {
                      "expr": "If(NarrowScreen, 'leaderboard')"
                    }
                  },
                  "elements": [
                    {
                      "id": "menuitem_10",
                      "name": "Your Scores",
                      "properties": {
                        "action": {
                          "expr": "ShowPage(YourScores)"
                        },
                        "label": "Your Scores"
                      },
                      "kind": "MenuItem"
                    },
                    {
                      "id": "menuitem_15",
                      "name": "Player Leagues",
                      "properties": {
                        "action": {
                          "expr": "ShowPage(PlayerLeagues)"
                        },
                        "label": "Player Leagues"
                      },
                      "kind": "MenuItem"
                    },
                    {
                      "id": "menuitem_16",
                      "name": "Potd Leagues",
                      "properties": {
                        "action": {
                          "expr": "ShowPage(PotdLeagues)"
                        },
                        "label": "POTD Leagues"
                      },
                      "kind": "MenuItem"
                    }
                  ],
                  "kind": "Menu"
                }
              ],
              "kind": "Block"
            },
            {
              "id": "menu_2",
              "name": "Other Menu",
              "properties": {
                "label": "Menu",
                "buttonStyles": {
                  "color": "white"
                },
                "iconName": "menu"
              },
              "elements": [
                {
                  "id": "menuitem_25",
                  "name": "Your Team",
                  "properties": {
                    "action": {
                      "expr": "ShowPage(YourTeam)"
                    }
                  },
                  "kind": "MenuItem"
                },
                {
                  "id": "menuitem_7",
                  "name": "Home",
                  "properties": {
                    "label": "Home",
                    "action": {
                      "expr": "ShowPage(HomePage)"
                    }
                  },
                  "kind": "MenuItem"
                },
                {
                  "id": "menuitem_4",
                  "name": "About Item",
                  "properties": {
                    "action": {
                      "expr": "ShowPage(AboutPage)"
                    },
                    "label": "About"
                  },
                  "kind": "MenuItem"
                },
                {
                  "id": "menuitem_5",
                  "name": "Terms",
                  "properties": {
                    "action": {
                      "expr": "ShowPage(Terms)"
                    },
                    "label": "Terms & Conditions"
                  },
                  "kind": "MenuItem"
                },
                {
                  "id": "menuitem_6",
                  "name": "Privacy",
                  "properties": {
                    "action": {
                      "expr": "ShowPage(Privacy)"
                    },
                    "label": "Privacy & Cookies"
                  },
                  "kind": "MenuItem"
                }
              ],
              "kind": "Menu"
            },
            {
              "id": "userlogon_1",
              "name": "User Logon 1",
              "properties": {},
              "kind": "UserLogon"
            }
          ],
          "kind": "AppBar"
        },
        {
          "id": "page_1",
          "name": "Home Page",
          "properties": {},
          "elements": [
            {
              "id": "text_4",
              "name": "Heading 1",
              "properties": {
                "content": "The No Boredom games and puzzles site!",
                "styles": {
                  "fontFamily": "Tahoma",
                  "fontSize": "20",
                  "color": "green",
                  "marginTop": "20px"
                }
              },
              "kind": "Text"
            },
            {
              "id": "text_2",
              "name": "Para 1",
              "properties": {
                "content": "Word puzzles, number games, visual brainteasers - try a different one every day.\n\nMost take less than 5 minutes, so you can fit them in whenever you want."
              },
              "kind": "Text"
            },
            {
              "id": "button_6",
              "name": "Todays Puzzle Button",
              "properties": {
                "content": "Try the Puzzle of the Day",
                "styles": {
                  "backgroundColor": "orange",
                  "color": "white",
                  "fontSize": "28",
                  "textTransform": "inherit"
                },
                "action": {
                  "expr": "ShowPage(TodaysPuzzle)"
                }
              },
              "kind": "Button"
            },
            {
              "id": "button_7",
              "name": "All Puzzles",
              "properties": {
                "appearance": "link",
                "action": {
                  "expr": "ShowPage(PuzzleArchive)"
                },
                "styles": {
                  "fontSize": "20"
                },
                "content": "All the Puzzles"
              },
              "kind": "Button"
            },
            {
              "id": "button_14",
              "name": "About Link",
              "properties": {
                "appearance": "link",
                "action": {
                  "expr": "ShowPage(AboutPage)"
                },
                "styles": {
                  "fontSize": "20"
                },
                "content": "About Puzzle Teams"
              },
              "kind": "Button"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_7",
          "name": "About Page",
          "properties": {},
          "elements": [
            {
              "id": "text_17",
              "name": "Heading 1",
              "properties": {
                "content": "The No Boredom puzzle site!",
                "styles": {
                  "fontFamily": "Tahoma",
                  "fontSize": "20",
                  "color": "green"
                }
              },
              "kind": "Text"
            },
            {
              "id": "text_18",
              "name": "Para 1",
              "properties": {
                "content": "Challenge your mind with a fresh puzzle every day.\nWord puzzles, number games, visual brainteasers and more.\nEach takes less than 5 minutes, so you can fit it in whenever you want."
              },
              "kind": "Text"
            },
            {
              "id": "text_19",
              "name": "Heading 2",
              "properties": {
                "content": "Team up with your friends",
                "styles": {
                  "fontFamily": "Tahoma",
                  "fontSize": "20",
                  "color": "green"
                }
              },
              "kind": "Text"
            },
            {
              "id": "text_20",
              "name": "Para 2",
              "properties": {
                "content": "You're welcome to play by yourself, but the real fun begins when you  start a team.  \nTeams compete with each other in leagues and one-off showdowns.  \nThe more people you get in your team, the better your chances!"
              },
              "kind": "Text"
            },
            {
              "id": "text_21",
              "name": "Heading 3",
              "properties": {
                "content": "Showcase your ideas",
                "styles": {
                  "fontFamily": "Tahoma",
                  "fontSize": "20",
                  "color": "green"
                }
              },
              "kind": "Text"
            },
            {
              "id": "text_22",
              "name": "Text 9",
              "properties": {
                "content": "Puzzle Teams runs off your creativity.\nIf you have an idea for a great puzzle, send it to us and you could see it on the site in a few days.\nEven better - program it yourself with the easy to use Elemento tool and get everyone playing the puzzle YOU created!"
              },
              "kind": "Text"
            },
            {
              "id": "button_10",
              "name": "Todays Puzzle Button",
              "properties": {
                "content": "Puzzle of the Day",
                "styles": {
                  "backgroundColor": "orange",
                  "color": "white",
                  "fontSize": "20",
                  "textTransform": "inherit"
                },
                "action": {
                  "expr": "ShowPage(TodaysPuzzle)"
                }
              },
              "kind": "Button"
            },
            {
              "id": "button_11",
              "name": "Puzzle Archive",
              "properties": {
                "appearance": "link",
                "action": {
                  "expr": "ShowPage(PuzzleArchive)"
                },
                "styles": {
                  "fontSize": "20"
                },
                "content": "All the Puzzles"
              },
              "kind": "Button"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_4",
          "name": "Todays Puzzle",
          "properties": {
            "styles": {
              "paddingLeft": "0",
              "paddingRight": "0",
              "paddingTop": "0",
              "paddingBottom": "0"
            }
          },
          "elements": [
            {
              "id": "frame_3",
              "name": "Puzzle Frame",
              "properties": {
                "source": {
                  "expr": "PuzzleOfTheDay()?.url"
                },
                "styles": {
                  "height": "calc(100% + 16px)",
                  "width": "calc(100% + 8px)",
                  "marginLeft": "-4px",
                  "marginRight": "-4px",
                  "marginTop": "-8px"
                }
              },
              "kind": "Frame"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_6",
          "name": "Archived Puzzle",
          "properties": {
            "styles": {
              "paddingLeft": "0",
              "paddingRight": "0",
              "paddingTop": "0",
              "padding": "0"
            }
          },
          "elements": [
            {
              "id": "calculation_2",
              "name": "Puzzle Id",
              "properties": {
                "calculation": {
                  "expr": "CurrentUrl().pathSections[0]"
                },
                "show": false
              },
              "kind": "Calculation"
            },
            {
              "id": "frame_4",
              "name": "Puzzle Frame",
              "properties": {
                "source": {
                  "expr": "Get(Puzzles, PuzzleId).url"
                },
                "styles": {
                  "height": "calc(100% + 16px)",
                  "width": "calc(100% + 8px)",
                  "marginTop": "-8px",
                  "marginLeft": "-4px",
                  "marginRight": "-4px"
                }
              },
              "kind": "Frame"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_5",
          "name": "Puzzle Archive",
          "properties": {},
          "elements": [
            {
              "id": "text_14",
              "name": "Title",
              "properties": {
                "content": "All Puzzles",
                "styles": {
                  "fontSize": "20",
                  "color": "green"
                }
              },
              "kind": "Text"
            },
            {
              "id": "itemset_1",
              "name": "Puzzle Item Set",
              "properties": {
                "selectable": "none",
                "items": {
                  "expr": "Query(Puzzles, {})"
                }
              },
              "elements": [
                {
                  "id": "block_1",
                  "name": "Block 1",
                  "properties": {
                    "layout": "vertical",
                    "styles": {
                      "fontSize": "18",
                      "gap": "0"
                    }
                  },
                  "elements": [
                    {
                      "id": "button_8",
                      "name": "Puzzle Link",
                      "properties": {
                        "content": {
                          "expr": "$item.name"
                        },
                        "appearance": "link",
                        "styles": {
                          "fontSize": "inherit"
                        },
                        "action": {
                          "expr": "ShowPage(ArchivedPuzzle, $item.id)"
                        }
                      },
                      "kind": "Button"
                    },
                    {
                      "id": "text_26",
                      "name": "Puzzle Description",
                      "properties": {
                        "content": {
                          "expr": "$item.description"
                        }
                      },
                      "kind": "Text"
                    }
                  ],
                  "kind": "Block"
                }
              ],
              "kind": "ItemSet"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_10",
          "name": "Your Scores",
          "properties": {},
          "elements": [
            {
              "id": "text_27",
              "name": "Title",
              "properties": {
                "content": "Your Scores",
                "styles": {
                  "fontSize": "20",
                  "color": "green"
                }
              },
              "kind": "Text"
            },
            {
              "id": "itemset_2",
              "name": "Plays Item Set",
              "properties": {
                "selectable": "none",
                "items": {
                  "expr": "Query(GamePlays, {UserId: CurrentUser().uid})"
                },
                "itemStyles": {
                  "width": "100%"
                }
              },
              "elements": [
                {
                  "id": "block_3",
                  "name": "Block 1",
                  "properties": {
                    "layout": "horizontal wrapped",
                    "styles": {
                      "fontSize": "18",
                      "gap": "0",
                      "width": "100%"
                    }
                  },
                  "elements": [
                    {
                      "id": "text_29",
                      "name": "Date Played",
                      "properties": {
                        "content": {
                          "expr": "DateFormat($item.DateTime, 'dd MMM yyyy')"
                        },
                        "styles": {
                          "fontSize": "inherit",
                          "width": "7em"
                        }
                      },
                      "kind": "Text"
                    },
                    {
                      "id": "button_18",
                      "name": "Puzzle Name",
                      "properties": {
                        "content": {
                          "expr": "Get(Puzzles, $item.PuzzleId).name"
                        },
                        "appearance": "link",
                        "styles": {
                          "fontSize": "inherit",
                          "flexGrow": "1"
                        },
                        "action": {
                          "expr": "ShowPage(ArchivedPuzzle, $item.PuzzleId)"
                        }
                      },
                      "kind": "Button"
                    },
                    {
                      "id": "text_28",
                      "name": "Score",
                      "properties": {
                        "content": {
                          "expr": "$item.Score"
                        },
                        "styles": {
                          "fontSize": "inherit",
                          "width": "3em",
                          "textAlign": "right"
                        }
                      },
                      "kind": "Text"
                    }
                  ],
                  "kind": "Block"
                }
              ],
              "kind": "ItemSet"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_17",
          "name": "Your Team",
          "properties": {},
          "elements": [
            {
              "id": "text_55",
              "name": "Title",
              "properties": {
                "content": "Your Team",
                "styles": {
                  "fontSize": "20",
                  "color": "green"
                }
              },
              "kind": "Text"
            },
            {
              "id": "calculation_12",
              "name": "In Team",
              "properties": {
                "calculation": {
                  "expr": "NotNull(UserData()?.TeamId)"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "data_6",
              "name": "Team",
              "properties": {
                "initialValue": {
                  "expr": "GetIfExists(Teams, UserData()?.TeamId)"
                }
              },
              "kind": "Data"
            },
            {
              "id": "text_65",
              "name": "Teams Blurb",
              "properties": {
                "content": "If you want to get the most out of Puzzle Teams ... join a Team!\n\nYou can enjoy a friendly rivalry with your other team members, and your team will also compete with other teams in the leagues and competitions.\n\nTo join a team, you will need an invitation code from the owner of the team.\n\nBut if you don't know anyone in a Puzzle Teams Team, why not find some friends or family members and start your own?\n",
                "show": {
                  "expr": "Not(InTeam)"
                }
              },
              "kind": "Text"
            },
            {
              "id": "block_10",
              "name": "Not In Team Block",
              "properties": {
                "show": {
                  "expr": "And(CurrentUser(), Not(InTeam))"
                },
                "layout": "horizontal wrapped"
              },
              "elements": [
                {
                  "id": "button_26",
                  "name": "Join A Team",
                  "properties": {
                    "action": {
                      "expr": "ShowPage(NewTeam)"
                    }
                  },
                  "kind": "Button"
                },
                {
                  "id": "button_25",
                  "name": "Start A New Team",
                  "properties": {
                    "action": {
                      "expr": "ShowPage(NewTeam)"
                    }
                  },
                  "kind": "Button"
                }
              ],
              "kind": "Block"
            },
            {
              "id": "block_12",
              "name": "Not Logged In Block",
              "properties": {
                "show": {
                  "expr": "Not(CurrentUser())"
                }
              },
              "elements": [
                {
                  "id": "text_62",
                  "name": "Log in Message",
                  "properties": {
                    "content": "You need to Log In or Sign Up to see your team details or join one."
                  },
                  "kind": "Text"
                },
                {
                  "id": "userlogon_3",
                  "name": "User Logon 3",
                  "properties": {},
                  "kind": "UserLogon"
                }
              ],
              "kind": "Block"
            },
            {
              "id": "text_64",
              "name": "In Team Message",
              "properties": {
                "content": {
                  "expr": "'You are a member of ' + '<span style=\"font-size: larger; color: green\">' + Team.Name + '</span>'"
                },
                "allowHtml": true,
                "show": {
                  "expr": "InTeam"
                }
              },
              "kind": "Text"
            },
            {
              "id": "block_9",
              "name": "In Team Block",
              "properties": {
                "show": {
                  "expr": "InTeam"
                }
              },
              "elements": [
                {
                  "id": "block_11",
                  "name": "Team Owner Block",
                  "properties": {
                    "show": {
                      "expr": "IsTeamOwner()"
                    },
                    "styles": {
                      "paddingLeft": "0"
                    }
                  },
                  "elements": [
                    {
                      "id": "text_61",
                      "name": "Message",
                      "properties": {
                        "content": "You are the owner of this team.",
                        "styles": {}
                      },
                      "kind": "Text"
                    },
                    {
                      "id": "button_27",
                      "name": "Invite Members",
                      "properties": {
                        "action": {
                          "expr": "ShowPage(NewInvite)"
                        }
                      },
                      "kind": "Button"
                    }
                  ],
                  "kind": "Block"
                },
                {
                  "id": "button_24",
                  "name": "Leave Team",
                  "properties": {
                    "action": {
                      "expr": "ShowPage(LeaveTeam)"
                    },
                    "appearance": "link"
                  },
                  "kind": "Button"
                }
              ],
              "kind": "Block"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_11",
          "name": "New Team",
          "properties": {},
          "elements": [
            {
              "id": "text_30",
              "name": "Title",
              "properties": {
                "content": "New Team",
                "styles": {
                  "fontSize": "20",
                  "color": "green"
                }
              },
              "kind": "Text"
            },
            {
              "id": "form_1",
              "name": "New Team Form",
              "properties": {
                "submitAction": {
                  "expr": "Log('Creating team', $form.value)\nPuzzlesServerApp.NewTeam($form)"
                },
                "label": " "
              },
              "elements": [
                {
                  "id": "textinput_1",
                  "name": "Team Name",
                  "properties": {},
                  "kind": "TextInput"
                },
                {
                  "id": "button_19",
                  "name": "Save",
                  "properties": {
                    "action": {
                      "expr": "$form.Submit()"
                    }
                  },
                  "kind": "Button"
                }
              ],
              "kind": "Form"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_12",
          "name": "New Invite",
          "properties": {},
          "elements": [
            {
              "id": "text_31",
              "name": "Title",
              "properties": {
                "content": "Invite a Team Member",
                "styles": {
                  "fontSize": "20",
                  "color": "green"
                }
              },
              "kind": "Text"
            },
            {
              "id": "data_2",
              "name": "Message Text",
              "properties": {
                "initialValue": {
                  "expr": "'Ready'"
                }
              },
              "kind": "Data"
            },
            {
              "id": "data_1",
              "name": "Invite Id",
              "properties": {},
              "kind": "Data"
            },
            {
              "id": "text_32",
              "name": "Message",
              "properties": {
                "content": {
                  "expr": "MessageText"
                }
              },
              "kind": "Text"
            },
            {
              "id": "block_4",
              "name": "Link Block",
              "properties": {
                "layout": "horizontal wrapped",
                "styles": {
                  "width": "100%"
                },
                "show": {
                  "expr": "NotNull(InviteId)"
                }
              },
              "elements": [
                {
                  "id": "calculation_13",
                  "name": "Invite Code",
                  "properties": {
                    "calculation": {
                      "expr": "InviteId"
                    },
                    "show": true,
                    "label": "Invite Code",
                    "styles": {
                      "width": "calc(100% - 5em)",
                      "maxWidth": "30em"
                    }
                  },
                  "kind": "Calculation"
                },
                {
                  "id": "calculation_4",
                  "name": "Invite Link",
                  "properties": {
                    "calculation": {
                      "expr": "InviteId ? CurrentUrl().text.replace(/\\/NewInvite/, '/JoinTeam/') + InviteId : null"
                    },
                    "show": true,
                    "label": "Invite Link",
                    "styles": {
                      "width": "calc(100% - 5em)",
                      "maxWidth": "30em"
                    }
                  },
                  "kind": "Calculation"
                },
                {
                  "id": "button_21",
                  "name": "Copy",
                  "properties": {
                    "iconName": "content_copy",
                    "styles": {
                      "height": "40"
                    },
                    "action": {
                      "expr": "window.navigator.clipboard.writeText(InviteLink.value)"
                    },
                    "show": {
                      "expr": "NotNull(InviteId)"
                    }
                  },
                  "kind": "Button"
                },
                {
                  "id": "text_66",
                  "name": "Link Usage Explanation",
                  "properties": {
                    "content": "Send the link above to the person you want to invite.\n\nAnyone who has the link can use it, but it can only be used once."
                  },
                  "kind": "Text"
                }
              ],
              "kind": "Block"
            },
            {
              "id": "button_20",
              "name": "Create Invite",
              "properties": {
                "action": {
                  "expr": "let inviteId = GetRandomId()\nLog('Creating invite', inviteId)\nSet(InviteId, null)\nSet(MessageText, 'Generating invite...')\nPuzzlesServerApp.InviteTeamMember(inviteId)\nSet(InviteId, inviteId)\nSet(MessageText, null)"
                },
                "content": "New Invite",
                "appearance": "filled"
              },
              "kind": "Button"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_13",
          "name": "Join Team",
          "properties": {
            "notLoggedInPage": {
              "expr": "JoinTeamLogin"
            }
          },
          "elements": [
            {
              "id": "text_33",
              "name": "Title",
              "properties": {
                "content": "Join a Team",
                "styles": {
                  "fontSize": "20",
                  "color": "green",
                  "marginBottom": "20"
                }
              },
              "kind": "Text"
            },
            {
              "id": "calculation_5",
              "name": "Invite Id",
              "properties": {
                "show": false,
                "calculation": {
                  "expr": "CurrentUrl().pathSections[0]"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "data_3",
              "name": "Invite",
              "properties": {
                "initialValue": {
                  "expr": "GetIfExists(Invites, InviteId)"
                }
              },
              "kind": "Data"
            },
            {
              "id": "data_4",
              "name": "Team",
              "properties": {
                "initialValue": {
                  "expr": "GetIfExists(Teams, Invite?.TeamId)"
                }
              },
              "kind": "Data"
            },
            {
              "id": "calculation_7",
              "name": "Invitation Used",
              "properties": {
                "calculation": {
                  "expr": "NotNull(Invite?.DateUsed)"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_8",
              "name": "In This Team",
              "properties": {
                "calculation": {
                  "expr": "Invite?.TeamId === UserData()?.TeamId"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_9",
              "name": "In Another Team",
              "properties": {
                "calculation": {
                  "expr": "And(UserData()?.TeamId, Invite?.TeamId !== UserData()?.TeamId)"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "data_5",
              "name": "Join State",
              "properties": {
                "initialValue": {
                  "expr": "'ready'"
                }
              },
              "kind": "Data"
            },
            {
              "id": "calculation_6",
              "name": "Invite Id Display",
              "properties": {
                "calculation": {
                  "expr": "Invite.id"
                },
                "show": true,
                "label": "Invitation Code"
              },
              "kind": "Calculation"
            },
            {
              "id": "text_43",
              "name": "Invitation",
              "properties": {
                "content": {
                  "expr": "'Invitation to join ' + '<span style=\"font-size: larger; color: green\">' + Team.Name + '</span>'"
                },
                "allowHtml": true,
                "show": {
                  "expr": "NotNull(Team) && JoinState == 'ready'"
                }
              },
              "kind": "Text"
            },
            {
              "id": "text_42",
              "name": "Already Used Message",
              "properties": {
                "content": "Sorry - this invitation has already been used",
                "show": {
                  "expr": "InvitationUsed"
                }
              },
              "kind": "Text"
            },
            {
              "id": "text_34",
              "name": "Already Member Message",
              "properties": {
                "content": {
                  "expr": "'You are already a member of ' + '<span style=\"font-size: larger; color: green\">' + Team.Name + '</span>'"
                },
                "allowHtml": true,
                "show": {
                  "expr": "InThisTeam"
                }
              },
              "kind": "Text"
            },
            {
              "id": "text_44",
              "name": "Already Member Elsewhere Message",
              "properties": {
                "content": "You are already a member of another team.  You will have to leave that team to join this one.",
                "allowHtml": true,
                "show": {
                  "expr": "InAnotherTeam"
                }
              },
              "kind": "Text"
            },
            {
              "id": "calculation_10",
              "name": "Can Join",
              "properties": {
                "calculation": {
                  "expr": "And(Not(InvitationUsed), Not(InThisTeam), Not(InAnotherTeam))"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "block_5",
              "name": "Join Block",
              "properties": {
                "show": {
                  "expr": "CanJoin"
                }
              },
              "elements": [
                {
                  "id": "text_38",
                  "name": "Joining Message",
                  "properties": {
                    "content": "Joining team....",
                    "show": {
                      "expr": "JoinState == 'joining'"
                    }
                  },
                  "kind": "Text"
                },
                {
                  "id": "text_39",
                  "name": "Congrats Message",
                  "properties": {
                    "content": {
                      "expr": "'Congratulations - you are now a member of ' + '<span style=\"font-size: larger; color: green\">' + Team.Name + '</span>'"
                    },
                    "allowHtml": true,
                    "show": {
                      "expr": "JoinState == 'joined'"
                    }
                  },
                  "kind": "Text"
                },
                {
                  "id": "button_22",
                  "name": "Join Team",
                  "properties": {
                    "action": {
                      "expr": "Set(JoinState,'joining')\nPuzzlesServerApp.AcceptInvite(Invite.id)\nSet(JoinState,'joined')"
                    },
                    "content": "Join the Team",
                    "appearance": "filled",
                    "enabled": {
                      "expr": "CanJoin"
                    }
                  },
                  "kind": "Button"
                }
              ],
              "kind": "Block"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_14",
          "name": "Join Team Login",
          "properties": {},
          "elements": [
            {
              "id": "text_40",
              "name": "Title",
              "properties": {
                "content": "Join a Team",
                "styles": {
                  "fontSize": "20",
                  "color": "green",
                  "marginBottom": "20"
                }
              },
              "kind": "Text"
            },
            {
              "id": "text_41",
              "name": "Login reminder",
              "properties": {
                "content": "Sorry - we need to know who you are before you can join a team. \nPlease Log In,  or Sign Up if you do not already have an account."
              },
              "kind": "Text"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_16",
          "name": "General Login",
          "properties": {},
          "elements": [
            {
              "id": "text_52",
              "name": "Title",
              "properties": {
                "content": "You need to be logged in!",
                "styles": {
                  "fontSize": "20",
                  "color": "green",
                  "marginBottom": "20"
                }
              },
              "kind": "Text"
            },
            {
              "id": "text_53",
              "name": "Login reminder",
              "properties": {
                "content": "Sorry - we would love to help you but we need to know who you are. \n\nPlease Log In using the button below.  \n\nIf you do not have an account yet, click the button anyway and it will tell you how to sign up."
              },
              "kind": "Text"
            },
            {
              "id": "userlogon_2",
              "name": "User Logon In Page",
              "properties": {},
              "kind": "UserLogon"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_15",
          "name": "Leave Team",
          "properties": {
            "notLoggedInPage": {
              "expr": "GeneralLogin"
            }
          },
          "elements": [
            {
              "id": "text_45",
              "name": "Title",
              "properties": {
                "content": "Leave your Team",
                "styles": {
                  "fontSize": "20",
                  "color": "green",
                  "marginBottom": "20"
                }
              },
              "kind": "Text"
            },
            {
              "id": "calculation_11",
              "name": "In Team",
              "properties": {
                "calculation": {
                  "expr": "NotNull(UserData()?.TeamId)"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "block_6",
              "name": "In Team Block",
              "properties": {
                "show": {
                  "expr": "And(InTeam, Not(IsTeamOwner()))"
                }
              },
              "elements": [
                {
                  "id": "text_56",
                  "name": "Explanation",
                  "properties": {
                    "content": "If you leave your team, you obviously won't be able to take part in the leagues or see the team scores any more.\n\nTo rejoin, or join another team, you will need a new invitation code.\n\nIf you're OK with that, then click the button below."
                  },
                  "kind": "Text"
                },
                {
                  "id": "button_23",
                  "name": "Leave Team",
                  "properties": {
                    "action": {
                      "expr": "PuzzlesServerApp.LeaveTeam()\nShowPage(YourTeam)"
                    }
                  },
                  "kind": "Button"
                }
              ],
              "kind": "Block"
            },
            {
              "id": "block_7",
              "name": "Not In Team Block",
              "properties": {
                "show": {
                  "expr": "Not(InTeam)"
                }
              },
              "elements": [
                {
                  "id": "text_57",
                  "name": "Message",
                  "properties": {
                    "content": "You are not in a team at the moment."
                  },
                  "kind": "Text"
                }
              ],
              "kind": "Block"
            },
            {
              "id": "block_8",
              "name": "Team Owner Block",
              "properties": {
                "show": {
                  "expr": "IsTeamOwner()"
                }
              },
              "elements": [
                {
                  "id": "text_58",
                  "name": "Message",
                  "properties": {
                    "content": "You are the owner of this team, so you cannot leave it.\n\nIf you want to transfer the team to someone else, please contact PuzzleTeams support."
                  },
                  "kind": "Text"
                }
              ],
              "kind": "Block"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_18",
          "name": "Player Leagues",
          "properties": {
            "notLoggedInPage": {
              "expr": "GeneralLogin"
            }
          },
          "elements": [
            {
              "id": "text_67",
              "name": "Title",
              "properties": {
                "content": {
                  "expr": "(UsersTeam()?.Name ?? '') +  ' Player Leagues'"
                },
                "styles": {
                  "fontSize": "20",
                  "color": "green"
                }
              },
              "kind": "Text"
            },
            {
              "id": "calculation_14",
              "name": "TheData",
              "properties": {
                "calculation": {
                  "expr": "If(UsersTeam(), PuzzlesServerApp.TeamGamePlays())"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_15",
              "name": "The Users",
              "properties": {
                "calculation": {
                  "expr": "TheData.value?.users"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_17",
              "name": "The Game Plays",
              "properties": {
                "calculation": {
                  "expr": "TheData.value?.gamePlays"
                },
                "styles": {
                  "width": "100% "
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_16",
              "name": "Users Display",
              "properties": {
                "calculation": {
                  "expr": "JSON.stringify(TheUsers.value, null, 2)"
                },
                "show": false,
                "styles": {
                  "width": "100%"
                },
                "label": "Users"
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_18",
              "name": "Game Plays Display",
              "properties": {
                "calculation": {
                  "expr": "JSON.stringify(TheGamePlays.value, null, 2)"
                },
                "show": false,
                "styles": {
                  "width": "100%"
                },
                "label": "Game Plays"
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_24",
              "name": "Selected Puzzle Id",
              "properties": {
                "calculation": {
                  "expr": "CurrentUrl().pathSections[0]"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_19",
              "name": "Game Plays For Puzzle",
              "properties": {
                "calculation": {
                  "expr": "Select(TheGamePlays, Eq($item.PuzzleId, SelectedPuzzleId))"
                },
                "show": false,
                "label": "Game Plays For Puzzle"
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_21",
              "name": "Game Plays By User",
              "properties": {
                "calculation": {
                  "expr": "GroupBy(GamePlaysForPuzzle, $item.UserId)"
                },
                "show": false,
                "label": "Game Plays By User"
              },
              "kind": "Calculation"
            },
            {
              "id": "function_15",
              "name": "User Result",
              "properties": {
                "input1": "gamePlays",
                "input2": "userId",
                "calculation": {
                  "expr": "let scores = ForEach(gamePlays, $item.Score)\nlet average = Round(Sum(...scores) / Count(scores))\nlet high = Max(...scores)\nlet userName = SelectFirst(TheUsers, $item.id === userId).DisplayName\nRecord('UserId', userId, 'Name', userName, 'Average', average, 'High', high)"
                }
              },
              "kind": "Function"
            },
            {
              "id": "calculation_22",
              "name": "Results By User",
              "properties": {
                "calculation": {
                  "expr": "ForEach(GamePlaysByUser, UserResult($item, $index))\n"
                },
                "show": false,
                "label": "Results By User"
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_23",
              "name": "Sorted Results",
              "properties": {
                "calculation": {
                  "expr": "Sort(ResultsByUser, -$item.High)"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_25",
              "name": "Popup List Needed",
              "properties": {
                "calculation": {
                  "expr": "AppWidth() < 500"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "data_7",
              "name": "Show List",
              "properties": {
                "initialValue": {
                  "expr": "false"
                }
              },
              "kind": "Data"
            },
            {
              "id": "calculation_26",
              "name": "Puzzle List Visible",
              "properties": {
                "calculation": {
                  "expr": "Or(Not(PopupListNeeded) , ShowList)"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "block_23",
              "name": "No Team Layout",
              "properties": {
                "show": {
                  "expr": "IsNull(UsersTeam())"
                }
              },
              "elements": [
                {
                  "id": "text_81",
                  "name": "Text 81",
                  "properties": {
                    "content": "Great that you're interested in the Puzzle Teams Leagues, but they are only for team members and unfortunately you don't seem to be in a team at the moment."
                  },
                  "kind": "Text"
                },
                {
                  "id": "text_82",
                  "name": "Text 82",
                  "properties": {
                    "content": "You can find out how to join or start a team on the Your Team page."
                  },
                  "elements": [],
                  "kind": "Text"
                },
                {
                  "id": "button_28",
                  "name": "Your Team Link",
                  "properties": {
                    "appearance": "filled",
                    "content": "Go To Your Team",
                    "action": {
                      "expr": "ShowPage(YourTeam)"
                    },
                    "styles": {
                      "display": "inline"
                    }
                  },
                  "kind": "Button"
                }
              ],
              "kind": "Block"
            },
            {
              "id": "block_14",
              "name": "In Team Layout",
              "properties": {
                "styles": {
                  "height": "100%",
                  "width": "100%"
                },
                "show": {
                  "expr": "NotNull(UsersTeam())"
                }
              },
              "elements": [
                {
                  "id": "block_31",
                  "name": "Puzzle Title Layout",
                  "properties": {
                    "layout": "horizontal"
                  },
                  "elements": [
                    {
                      "id": "text_94",
                      "name": "Puzzle Name",
                      "properties": {
                        "content": {
                          "expr": "PuzzleChooser.selectedItem?.name ?? '&nbsp;'"
                        },
                        "styles": {
                          "color": "green",
                          "fontSize": "18"
                        },
                        "allowHtml": true
                      },
                      "kind": "Text"
                    },
                    {
                      "id": "button_29",
                      "name": "Select",
                      "properties": {
                        "action": {
                          "expr": "Set(ShowList, true)"
                        },
                        "show": {
                          "expr": "PopupListNeeded"
                        }
                      },
                      "kind": "Button"
                    }
                  ],
                  "kind": "Block"
                },
                {
                  "id": "block_24",
                  "name": "Main Layout",
                  "properties": {
                    "layout": "horizontal",
                    "styles": {
                      "maxHeight": "calc(100% - 48px)",
                      "position": "relative",
                      "minHeight": "300"
                    }
                  },
                  "elements": [
                    {
                      "id": "block_26",
                      "name": "Puzzles List",
                      "properties": {
                        "styles": {
                          "backgroundColor": "#fed867",
                          "height": "100%",
                          "boxShadow": {
                            "expr": "If(PopupListNeeded, '0px 0px 5px 10px #B2AEB2')"
                          },
                          "position": {
                            "expr": "If(PopupListNeeded, 'absolute')"
                          },
                          "top": {
                            "expr": "If(PopupListNeeded, '-7px')"
                          },
                          "left": {
                            "expr": "If(PopupListNeeded, '90px')"
                          }
                        },
                        "show": {
                          "expr": "PuzzleListVisible"
                        }
                      },
                      "elements": [
                        {
                          "id": "itemset_3",
                          "name": "Puzzle Chooser",
                          "properties": {
                            "items": {
                              "expr": "Query(Puzzles, {})"
                            },
                            "selectable": "none",
                            "itemStyles": {
                              "width": "100%"
                            },
                            "selectAction": {
                              "expr": "Set(ShowList, false)\nShowPage(PlayerLeagues, $item.id)"
                            },
                            "selectedItems": {
                              "expr": "SelectedPuzzleId"
                            }
                          },
                          "elements": [
                            {
                              "id": "text_84",
                              "name": "Puzzle Name",
                              "properties": {
                                "content": {
                                  "expr": "$item.name"
                                },
                                "styles": {
                                  "cursor": "pointer",
                                  "backgroundColor": {
                                    "expr": "If($selected, 'white', 'transparent')"
                                  },
                                  "padding": "2"
                                }
                              },
                              "kind": "Text"
                            }
                          ],
                          "kind": "ItemSet"
                        }
                      ],
                      "kind": "Block"
                    },
                    {
                      "id": "block_30",
                      "name": "League Table",
                      "properties": {
                        "styles": {
                          "padding": "0"
                        }
                      },
                      "elements": [
                        {
                          "id": "block_28",
                          "name": "League Title",
                          "properties": {
                            "layout": "horizontal",
                            "styles": {
                              "backgroundColor": "#fed867",
                              "padding": "2px 5px"
                            }
                          },
                          "elements": [
                            {
                              "id": "text_86",
                              "name": "Name",
                              "properties": {
                                "content": "Player",
                                "styles": {
                                  "width": "8em"
                                }
                              },
                              "kind": "Text"
                            },
                            {
                              "id": "text_87",
                              "name": "High Score",
                              "properties": {
                                "content": "High",
                                "styles": {
                                  "textAlign": "right",
                                  "width": "3em"
                                }
                              },
                              "kind": "Text"
                            },
                            {
                              "id": "text_88",
                              "name": "Average",
                              "properties": {
                                "content": "Ave",
                                "styles": {
                                  "width": "3em",
                                  "textAlign": "right"
                                }
                              },
                              "kind": "Text"
                            }
                          ],
                          "kind": "Block"
                        },
                        {
                          "id": "block_32",
                          "name": "Item Layout",
                          "properties": {},
                          "elements": [
                            {
                              "id": "itemset_4",
                              "name": "League Items",
                              "properties": {
                                "items": {
                                  "expr": "SortedResults"
                                }
                              },
                              "elements": [
                                {
                                  "id": "block_33",
                                  "name": "League Entry",
                                  "properties": {
                                    "layout": "horizontal",
                                    "styles": {
                                      "borderWidth": "2px",
                                      "borderColor": "black"
                                    }
                                  },
                                  "elements": [
                                    {
                                      "id": "text_95",
                                      "name": "Name",
                                      "properties": {
                                        "content": {
                                          "expr": "$item.Name"
                                        },
                                        "styles": {
                                          "width": "8em"
                                        }
                                      },
                                      "kind": "Text"
                                    },
                                    {
                                      "id": "text_96",
                                      "name": "High Score",
                                      "properties": {
                                        "content": {
                                          "expr": "$item.High"
                                        },
                                        "styles": {
                                          "textAlign": "right",
                                          "width": "3em"
                                        }
                                      },
                                      "kind": "Text"
                                    },
                                    {
                                      "id": "text_97",
                                      "name": "Average",
                                      "properties": {
                                        "content": {
                                          "expr": "$item.Average"
                                        },
                                        "styles": {
                                          "width": "3em",
                                          "textAlign": "right"
                                        }
                                      },
                                      "kind": "Text"
                                    }
                                  ],
                                  "kind": "Block"
                                }
                              ],
                              "kind": "ItemSet"
                            }
                          ],
                          "kind": "Block"
                        },
                        {
                          "id": "text_89",
                          "name": "No Selection Text",
                          "properties": {
                            "content": "Please select a Puzzle",
                            "show": {
                              "expr": "IsNull(SelectedPuzzleId)"
                            }
                          },
                          "kind": "Text"
                        },
                        {
                          "id": "text_90",
                          "name": "No Results Text",
                          "properties": {
                            "content": "No-one in your team has played this puzzle yet \n- why not be the first?",
                            "show": {
                              "expr": "And(NotNull(SelectedPuzzleId), Count(SortedResults) === 0)"
                            }
                          },
                          "kind": "Text"
                        }
                      ],
                      "kind": "Block"
                    }
                  ],
                  "kind": "Block"
                }
              ],
              "kind": "Block"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_19",
          "name": "Potd Leagues",
          "properties": {
            "notLoggedInPage": {
              "expr": "GeneralLogin"
            }
          },
          "elements": [
            {
              "id": "text_98",
              "name": "Title",
              "properties": {
                "content": "Puzzle of the Day Leagues",
                "styles": {
                  "fontSize": "20",
                  "color": "green"
                }
              },
              "kind": "Text"
            },
            {
              "id": "calculation_31",
              "name": "Day Puzzles",
              "properties": {
                "calculation": {
                  "expr": "PuzzlesServerApp.DayPuzzleData()"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_32",
              "name": "Days Available",
              "properties": {
                "calculation": {
                  "expr": "ForEach(DayPuzzles, $item.id)"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_27",
              "name": "Day List",
              "properties": {
                "calculation": {
                  "expr": "Sort(DaysAvailable, -DateVal($item))"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_33",
              "name": "Day Selector Items",
              "properties": {
                "calculation": {
                  "expr": "ForEach(DayList, DateFormat(DateVal($item), 'd MMMM'))"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "block_38",
              "name": "Selector Layout",
              "properties": {
                "layout": "horizontal",
                "styles": {
                  "width": "100%"
                }
              },
              "elements": [
                {
                  "id": "selectinput_1",
                  "name": "Day Selector",
                  "properties": {
                    "label": "Day",
                    "values": {
                      "expr": "DaySelectorItems"
                    },
                    "styles": {
                      "minWidth": "10em"
                    },
                    "initialValue": {
                      "expr": "ItemAt(DaySelectorItems, 0)"
                    }
                  },
                  "kind": "SelectInput"
                },
                {
                  "id": "text_111",
                  "name": "Puzzle Name",
                  "properties": {
                    "content": {
                      "expr": "DayPuzzles.value?.[SelectedDate.value]?.Name"
                    },
                    "styles": {
                      "color": "green",
                      "fontSize": "20"
                    }
                  },
                  "kind": "Text"
                }
              ],
              "kind": "Block"
            },
            {
              "id": "calculation_28",
              "name": "Selected Date",
              "properties": {
                "calculation": {
                  "expr": "DateVal(DaySelector.value,  'd MMMM')?.toISOString().substring(0, 10)"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "calculation_30",
              "name": "Team Names",
              "properties": {
                "calculation": {
                  "expr": "PuzzlesServerApp.TeamNames()"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "data_8",
              "name": "Sort Item",
              "properties": {
                "initialValue": {
                  "expr": "'Total'"
                }
              },
              "kind": "Data"
            },
            {
              "id": "calculation_29",
              "name": "Sorted Results",
              "properties": {
                "calculation": {
                  "expr": "If(SelectedDate, Sort(PuzzlesServerApp.PotdLeagueData(SelectedDate.value), -$item[SortItem]), [])"
                }
              },
              "kind": "Calculation"
            },
            {
              "id": "block_37",
              "name": "League Table",
              "properties": {
                "styles": {
                  "padding": "0",
                  "width": "100%"
                }
              },
              "elements": [
                {
                  "id": "block_34",
                  "name": "League Title",
                  "properties": {
                    "layout": "horizontal",
                    "styles": {
                      "backgroundColor": "#fed867",
                      "padding": "2px 5px",
                      "height": "30px",
                      "gap": "0",
                      "width": "100%"
                    }
                  },
                  "elements": [
                    {
                      "id": "text_99",
                      "name": "Name",
                      "properties": {
                        "content": "Team",
                        "styles": {
                          "paddingRight": "16px",
                          "flexGrow": "1",
                          "width": "8em",
                          "maxWidth": "15em"
                        }
                      },
                      "kind": "Text"
                    },
                    {
                      "id": "button_33",
                      "name": "Total",
                      "properties": {
                        "appearance": "link",
                        "styles": {
                          "borderLeft": "1px solid gray",
                          "padding": "0 8px",
                          "textAlign": "center",
                          "width": "3em",
                          "backgroundColor": {
                            "expr": "If(SortItem == 'Total', 'white')"
                          }
                        },
                        "action": {
                          "expr": "Set(SortItem, 'Total')"
                        }
                      },
                      "kind": "Button"
                    },
                    {
                      "id": "button_30",
                      "name": "Players",
                      "properties": {
                        "appearance": "link",
                        "styles": {
                          "borderLeft": "1px solid gray",
                          "padding": "0 8px",
                          "textAlign": "center",
                          "width": "3.5em",
                          "backgroundColor": {
                            "expr": "If(SortItem == 'Count', 'white')"
                          }
                        },
                        "action": {
                          "expr": "Set(SortItem, 'Count')"
                        }
                      },
                      "kind": "Button"
                    },
                    {
                      "id": "button_31",
                      "name": "Average",
                      "properties": {
                        "appearance": "link",
                        "styles": {
                          "borderLeft": "1px solid gray",
                          "padding": "0 8px",
                          "textAlign": "center",
                          "width": "3em",
                          "backgroundColor": {
                            "expr": "If(SortItem == 'Average', 'white')"
                          }
                        },
                        "action": {
                          "expr": "Set(SortItem, 'Average')"
                        },
                        "content": "Avg"
                      },
                      "kind": "Button"
                    },
                    {
                      "id": "button_32",
                      "name": "Highest",
                      "properties": {
                        "appearance": "link",
                        "styles": {
                          "borderLeft": "1px solid gray",
                          "padding": "0 8px",
                          "textAlign": "center",
                          "width": "3em",
                          "backgroundColor": {
                            "expr": "If(SortItem == 'Max', 'white')"
                          }
                        },
                        "action": {
                          "expr": "Set(SortItem, 'Max')"
                        }
                      },
                      "kind": "Button"
                    }
                  ],
                  "kind": "Block"
                },
                {
                  "id": "block_36",
                  "name": "Item Layout",
                  "properties": {
                    "styles": {
                      "width": "100%"
                    }
                  },
                  "elements": [
                    {
                      "id": "itemset_5",
                      "name": "League Items",
                      "properties": {
                        "items": {
                          "expr": "SortedResults"
                        },
                        "itemStyles": {
                          "width": "100%"
                        }
                      },
                      "elements": [
                        {
                          "id": "block_35",
                          "name": "League Entry",
                          "properties": {
                            "layout": "horizontal",
                            "styles": {
                              "borderWidth": "2px",
                              "borderColor": "black",
                              "width": "100%"
                            }
                          },
                          "elements": [
                            {
                              "id": "text_102",
                              "name": "Name",
                              "properties": {
                                "content": {
                                  "expr": "TeamNames.value[$item.TeamId]"
                                },
                                "styles": {
                                  "width": "8em",
                                  "flexGrow": "1",
                                  "maxWidth": "15em"
                                }
                              },
                              "kind": "Text"
                            },
                            {
                              "id": "text_103",
                              "name": "Total",
                              "properties": {
                                "content": {
                                  "expr": "$item.Total"
                                },
                                "styles": {
                                  "textAlign": "right",
                                  "width": "3em"
                                }
                              },
                              "kind": "Text"
                            },
                            {
                              "id": "text_109",
                              "name": "Players",
                              "properties": {
                                "content": {
                                  "expr": "$item.Count"
                                },
                                "styles": {
                                  "textAlign": "right",
                                  "width": "3.5em"
                                }
                              },
                              "kind": "Text"
                            },
                            {
                              "id": "text_104",
                              "name": "Average",
                              "properties": {
                                "content": {
                                  "expr": "$item.Average"
                                },
                                "styles": {
                                  "width": "3em",
                                  "textAlign": "right"
                                }
                              },
                              "kind": "Text"
                            },
                            {
                              "id": "text_110",
                              "name": "Highest",
                              "properties": {
                                "content": {
                                  "expr": "$item.Max"
                                },
                                "styles": {
                                  "width": "3em",
                                  "textAlign": "right"
                                }
                              },
                              "kind": "Text"
                            }
                          ],
                          "kind": "Block"
                        }
                      ],
                      "kind": "ItemSet"
                    }
                  ],
                  "kind": "Block"
                },
                {
                  "id": "text_105",
                  "name": "No Selection Text",
                  "properties": {
                    "content": "Please select a Day",
                    "show": {
                      "expr": "IsNull(SelectedDate)"
                    }
                  },
                  "kind": "Text"
                },
                {
                  "id": "text_106",
                  "name": "No Results Text",
                  "properties": {
                    "content": "No results for this day",
                    "show": {
                      "expr": "And(NotNull(SelectedDate), Count(SortedResults) === 0)"
                    }
                  },
                  "kind": "Text"
                }
              ],
              "kind": "Block"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_8",
          "name": "Terms",
          "properties": {},
          "elements": [
            {
              "id": "webfile_1",
              "name": "Terms File",
              "properties": {
                "url": "../files/terms.html"
              },
              "kind": "WebFile"
            },
            {
              "id": "text_23",
              "name": "Terms Text",
              "properties": {
                "content": {
                  "expr": "TermsFile"
                },
                "allowHtml": true
              },
              "kind": "Text"
            }
          ],
          "kind": "Page"
        },
        {
          "id": "page_9",
          "name": "Privacy",
          "properties": {},
          "elements": [
            {
              "id": "webfile_2",
              "name": "Privacy File",
              "properties": {
                "url": "../files/privacycookies.html"
              },
              "kind": "WebFile"
            },
            {
              "id": "text_25",
              "name": "Terms Text",
              "properties": {
                "content": {
                  "expr": "PrivacyFile"
                },
                "allowHtml": true
              },
              "kind": "Text"
            }
          ],
          "kind": "Page"
        }
      ],
      "kind": "App"
    },
    {
      "id": "serverapp_1",
      "name": "Puzzles Server",
      "properties": {},
      "elements": [
        {
          "id": "firestoredatastore_2",
          "name": "Server Data Store",
          "properties": {
            "collections": "Teams\nUsers\nInvites\nGamePlays\nPuzzles\nDayPuzzles"
          },
          "kind": "FirestoreDataStore"
        },
        {
          "id": "collection_3",
          "name": "Teams",
          "properties": {
            "dataStore": {
              "expr": "ServerDataStore"
            },
            "collectionName": "Teams"
          },
          "kind": "Collection"
        },
        {
          "id": "collection_4",
          "name": "Users",
          "properties": {
            "dataStore": {
              "expr": "ServerDataStore"
            },
            "collectionName": "Users"
          },
          "kind": "Collection"
        },
        {
          "id": "collection_7",
          "name": "Invites",
          "properties": {
            "dataStore": {
              "expr": "ServerDataStore"
            },
            "collectionName": "Invites"
          },
          "kind": "Collection"
        },
        {
          "id": "collection_9",
          "name": "Game Plays",
          "properties": {
            "dataStore": {
              "expr": "ServerDataStore"
            },
            "collectionName": "GamePlays"
          },
          "kind": "Collection"
        },
        {
          "id": "collection_11",
          "name": "Puzzles",
          "properties": {
            "dataStore": {
              "expr": "ServerDataStore"
            },
            "collectionName": "Puzzles"
          },
          "kind": "Collection"
        },
        {
          "id": "collection_12",
          "name": "Day Puzzles",
          "properties": {
            "dataStore": {
              "expr": "ServerDataStore"
            },
            "collectionName": "DayPuzzles"
          },
          "kind": "Collection"
        },
        {
          "id": "function_17",
          "name": "Puzzle Of The Day",
          "properties": {
            "calculation": {
              "expr": "let puzzleDay = date ?? Today()\nlet dayPuzzleId = puzzleDay.toISOString().substring(0, 10)\nlet dayPuzzle = Get(DayPuzzles, dayPuzzleId)\nGet(Puzzles, dayPuzzle.puzzleId)"
            },
            "input1": "date"
          },
          "kind": "Function"
        },
        {
          "id": "function_5",
          "name": "Update User Data",
          "properties": {
            "input1": "changes",
            "action": true,
            "calculation": {
              "expr": "let user = GetUserData()\nlet userId = CurrentUser().uid\nIf(user, Update(Users, userId, changes), Add(Users, Record(changes, 'id', userId, 'DisplayName', CurrentUser().Name))) "
            }
          },
          "kind": "Function"
        },
        {
          "id": "function_6",
          "name": "Get User Data",
          "properties": {
            "action": false,
            "calculation": {
              "expr": "GetIfExists(Users, CurrentUser()?.uid)\n"
            }
          },
          "kind": "Function"
        },
        {
          "id": "function_4",
          "name": "New Team",
          "properties": {
            "input1": "teamData",
            "action": true,
            "calculation": {
              "expr": "Log('In NewTeam', teamData)\nlet user = GetUserData()\nCheck(Not(user?.TeamId), 'Cannot create new team as already a member of a team')\nlet team = Add(Teams, Record('Name', teamData.TeamName, 'OwnerId', CurrentUser().uid))\nUpdateUserData(Record('TeamId', team.id))\nLog('Done NewTeam')"
            }
          },
          "kind": "Function"
        },
        {
          "id": "function_10",
          "name": "Invite Team Member",
          "properties": {
            "action": true,
            "calculation": {
              "expr": "let user = GetUserData()\nlet team = Get(Teams, user?.TeamId)\nCheck(team?.OwnerId == user.id, 'Cannot invite a team member unless you are the owner')\nAdd(Invites, Record('id', inviteId, 'TeamId', team.id, 'DateCreated', Now()))"
            },
            "input1": "inviteId"
          },
          "kind": "Function"
        },
        {
          "id": "function_12",
          "name": "Accept Invite",
          "properties": {
            "calculation": {
              "expr": "let user = GetUserData()\nlet invite = Get(Invites, inviteId)\nCheck(IsNull(invite.DateUsed), 'This invite has already been used')\nCheck(IsNull(user?.TeamId), 'Cannot join a team if you are already in a team')\nUpdateUserData(Record('TeamId', invite.TeamId, 'DateJoinedTeam', Today()))\nUpdate(Invites, inviteId, Record('DateUsed', Now()))"
            },
            "input1": "inviteId",
            "action": true
          },
          "kind": "Function"
        },
        {
          "id": "function_13",
          "name": "Leave Team",
          "properties": {
            "calculation": {
              "expr": "UpdateUserData(Record('TeamId', null, 'DateJoinedTeam', null))"
            },
            "action": true
          },
          "kind": "Function"
        },
        {
          "id": "function_14",
          "name": "Team Game Plays",
          "properties": {
            "calculation": {
              "expr": "let teamId = GetUserData()?.TeamId\nlet gamePlays = If(teamId, Query(GamePlays, {TeamId: teamId}))\nlet users = If(teamId, Query(Users, {TeamId: teamId}))\nRecord({gamePlays: gamePlays, users: users})"
            }
          },
          "kind": "Function"
        },
        {
          "id": "function_19",
          "name": "TeamStats",
          "properties": {
            "private": true,
            "input1": "teamScoreGroups",
            "calculation": {
              "expr": "function teamItem(scoreItems) {\n  let teamId = scoreItems[0].TeamId\n  let scores = ForEach(scoreItems, $item => $item.HighScore)\n  let max = Max(scores)\n  let count = Count(scores)\n  let total = Sum(scores)\n  let ave = Floor(total/count)\n  return Record({TeamId: teamId, Max: max, Average: ave, Total: total, Count: count})\n}\nreturn ForEach(teamScoreGroups, $item => teamItem($item))"
            },
            "javascript": true
          },
          "kind": "Function"
        },
        {
          "id": "function_18",
          "name": "Potd League Data",
          "properties": {
            "calculation": {
              "expr": "let puzzleId = PuzzleOfTheDay(date)?.id\nPuzzleDayLeagueData(puzzleId, date)"
            },
            "input1": "date"
          },
          "kind": "Function"
        },
        {
          "id": "function_21",
          "name": "Puzzle Day League Data",
          "properties": {
            "calculation": {
              "expr": "let dateTo = DateAdd(date, 1,  'days')\nlet plays = Query(GamePlays, [['PuzzleId', '==', puzzleId], ['DateTime', '>=', date], ['DateTime', '<', dateTo]])\nlet playerGroups = GroupBy(plays, $item.UserId)\nlet playerHighScores = ForEach(playerGroups, Record('UserId', $item[0].UserId, 'TeamId', $item[0].TeamId, 'HighScore', Max(ForEach($item, $item.Score))))\nlet teamScoreGroups = GroupBy(playerHighScores, $item.TeamId)\nlet teamStats = TeamStats(teamScoreGroups)\nlet qualifyingTeams = Select(teamStats, $item.Count > 1)\nqualifyingTeams"
            },
            "input1": "puzzleId",
            "input2": "date"
          },
          "kind": "Function"
        },
        {
          "id": "function_22",
          "name": "Team Names",
          "properties": {
            "calculation": {
              "expr": "let allTeams = await Query(Teams, {})\nlet teamEntries = ForEach(allTeams, $item => [$item.id, $item.Name])\nreturn Object.fromEntries(teamEntries)"
            },
            "javascript": true
          },
          "kind": "Function"
        },
        {
          "id": "function_23",
          "name": "Day Puzzle Data",
          "properties": {
            "calculation": {
              "expr": "let puzzles = await Query(Puzzles, {})\n\nlet today = Today().toISOString().substring(0, 10)\nfunction puzzleName(id) {\n  return puzzles.find( p => p.id === id)?.name\n}\nlet allPreviousDayPuzzles = await Query(DayPuzzles, [['id', '<', today]])\nlet entries = ForEach(allPreviousDayPuzzles, $item => [$item.id, {id: $item.id, Name: puzzleName($item.puzzleId)}])\nreturn Object.fromEntries(entries)"
            },
            "javascript": true
          },
          "kind": "Function"
        }
      ],
      "kind": "ServerApp"
    },
    {
      "id": "_TOOLS",
      "name": "Tools",
      "properties": {},
      "kind": "ToolFolder"
    },
    {
      "id": "_COMPONENTS",
      "name": "Components",
      "properties": {},
      "kind": "ComponentFolder"
    }
  ],
  "kind": "Project"
}